(()=>{var e={9590:e=>{var t="undefined"!=typeof Element,n="function"==typeof Map,r="function"==typeof Set,o="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function i(e,s){if(e===s)return!0;if(e&&s&&"object"==typeof e&&"object"==typeof s){if(e.constructor!==s.constructor)return!1;var a,u,c,l;if(Array.isArray(e)){if((a=e.length)!=s.length)return!1;for(u=a;0!=u--;)if(!i(e[u],s[u]))return!1;return!0}if(n&&e instanceof Map&&s instanceof Map){if(e.size!==s.size)return!1;for(l=e.entries();!(u=l.next()).done;)if(!s.has(u.value[0]))return!1;for(l=e.entries();!(u=l.next()).done;)if(!i(u.value[1],s.get(u.value[0])))return!1;return!0}if(r&&e instanceof Set&&s instanceof Set){if(e.size!==s.size)return!1;for(l=e.entries();!(u=l.next()).done;)if(!s.has(u.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(s)){if((a=e.length)!=s.length)return!1;for(u=a;0!=u--;)if(e[u]!==s[u])return!1;return!0}if(e.constructor===RegExp)return e.source===s.source&&e.flags===s.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===s.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===s.toString();if((a=(c=Object.keys(e)).length)!==Object.keys(s).length)return!1;for(u=a;0!=u--;)if(!Object.prototype.hasOwnProperty.call(s,c[u]))return!1;if(t&&e instanceof Element)return!1;for(u=a;0!=u--;)if(("_owner"!==c[u]&&"__v"!==c[u]&&"__o"!==c[u]||!e.$$typeof)&&!i(e[c[u]],s[c[u]]))return!1;return!0}return e!=e&&s!=s}e.exports=function(e,t){try{return i(e,t)}catch(e){if((e.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw e}}},4670:(e,t,n)=>{"use strict";e.exports=n(5607)},9829:(e,t,n)=>{"use strict";var r,o,i,s=n(8946),a="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";function u(){i=!1}function c(e){if(e){if(e!==r){if(e.length!==a.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter((function(e,t,n){return t!==n.lastIndexOf(e)}));if(t.length)throw new Error("Custom alphabet for shortid must be "+a.length+" unique characters. These characters were not unique: "+t.join(", "));r=e,u()}}else r!==a&&(r=a,u())}function l(){return i||(i=function(){r||c(a);for(var e,t=r.split(""),n=[],o=s.nextValue();t.length>0;)o=s.nextValue(),e=Math.floor(o*t.length),n.push(t.splice(e,1)[0]);return n.join("")}())}e.exports={get:function(){return r||a},characters:function(e){return c(e),r},seed:function(e){s.seed(e),o!==e&&(u(),o=e)},lookup:function(e){return l()[e]},shuffled:l}},480:(e,t,n)=>{"use strict";var r,o,i=n(8416);n(9829),e.exports=function(e){var t="",n=Math.floor(.001*(Date.now()-1567752802062));return n===o?r++:(r=0,o=n),t+=i(7),t+=i(e),r>0&&(t+=i(r)),t+i(n)}},8416:(e,t,n)=>{"use strict";var r=n(9829),o=n(3766),i=n(296);e.exports=function(e){for(var t,n=0,s="";!t;)s+=i(o,r.get(),1),t=e<Math.pow(16,n+1),n++;return s}},5607:(e,t,n)=>{"use strict";var r=n(9829),o=n(480),i=n(1082),s=n(5636)||0;function a(){return o(s)}e.exports=a,e.exports.generate=a,e.exports.seed=function(t){return r.seed(t),e.exports},e.exports.worker=function(t){return s=t,e.exports},e.exports.characters=function(e){return void 0!==e&&r.characters(e),r.shuffled()},e.exports.isValid=i},1082:(e,t,n)=>{"use strict";var r=n(9829);e.exports=function(e){return!(!e||"string"!=typeof e||e.length<6||new RegExp("[^"+r.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e))}},3766:e=>{"use strict";var t,n="object"==typeof window&&(window.crypto||window.msCrypto);t=n&&n.getRandomValues?function(e){return n.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t},e.exports=t},8946:e=>{"use strict";var t=1;e.exports={nextValue:function(){return(t=(9301*t+49297)%233280)/233280},seed:function(e){t=e}}},5636:e=>{"use strict";e.exports=0},296:e=>{e.exports=function(e,t,n){for(var r=(2<<Math.log(t.length-1)/Math.LN2)-1,o=-~(1.6*r*n/t.length),i="";;)for(var s=e(o),a=o;a--;)if((i+=t[s[a]&r]||"").length===+n)return i}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{MENU_ITEM_BLOCK:()=>h,MenuEntityProvider:()=>C,createPrimaryMenu:()=>j,generateItemInitialData:()=>M,gutentagMenuEntity:()=>p,useMenuBlockEditor:()=>L,useMenusLocations:()=>_,usePrimaryMenuBlockEditor:()=>S});const e=window.React,t=window.kubio.globalData,o=window.wp.apiFetch;var i=n.n(o);const s=window.wp.blocks,a=window.wp.data,u=window.wp.element,c=window.wp.i18n,l=window.lodash;var d=n(9590),f=n.n(d),g=n(4670);const p={name:"menu",kind:"kubio",baseURL:"/kubio/v1/menu",plural:"menus",label:(0,c.__)("Menu","kubio"),mergedEdits:{meta:!0},getTitle:e=>{var t;return(0,l.isString)(null===(t=e)||void 0===t?void 0:t.data)&&(e=JSON.parse(e.data)),(0,l.get)(e,"menu.name",(0,c.__)("Menu Title","kubio"))}},h="kubio/menu-item",v={},m=(0,g.generate)();let b=(0,g.generate)();const w=()=>(v.context||(v.context=(0,u.createContext)()),v);function y(){var e;return null===(e=(0,u.useContext)(w().context))||void 0===e?void 0:e.id}const M=()=>{const e=-1*Date.now();return{id:e,parent:0,type:"custom",objectId:e,label:"",url:"",target:""}},x={content:{},isResolving:!1,hasResolved:!1,lastChange:m};function R(e,t={}){const n=y(),r=null!=e?e:n,{editedEntity:o,isResolving:i,hasResolved:s}=(0,a.useSelect)((e=>r<0?{editedEntity:null,isResolving:!1,hasResolved:!0}:{editedEntity:e("core").getEditedEntityRecord(p.kind,p.name,r,t),isResolving:e("core").isResolving("getEditedEntityRecord",[p.kind,p.name,r,t]),hasResolved:e("core").hasFinishedResolution("getEditedEntityRecord",[p.kind,p.name,r,t])})),c=null==o?void 0:o.lastChange,l=null==o?void 0:o.data;return(0,u.useMemo)((()=>!parseInt(r)&&r<0?x:{content:l&&JSON.parse(l),isResolving:i,hasResolved:s,lastChange:c||m}),[r,l,i,s,c])}function k(e,t,n={}){const r=y(),o=null!=t?t:r,{content:i,lastChange:s}=R(o,n),c=(0,u.useMemo)((()=>i&&i[e]),[i,e]),l=(0,u.useMemo)((()=>i&&(i.lastReloadUID||"")),[i]),{editEntityRecord:d}=(0,a.useDispatch)("core");return[c,(0,u.useCallback)(((t,n=!1)=>{const r={...i,[e]:t,lastReloadUID:n?(0,g.generate)():i.lastReloadUID};if("items"===e){const e=[...i.items||[]].sort(((e,t)=>e.id-t.id)),n=[...t||[]].sort(((e,t)=>e.id-t.id));if(f()(e,n))return}d(p.kind,p.name,o,{data:JSON.stringify(r),lastChange:(0,g.generate)()})}),[o,e,i]),s,l]}const E=(e,t=0)=>(0,l.isArray)(e)?e.filter((e=>e.parent===t&&!(0,l.isUndefined)(e.id))).sort(((e,t)=>e.order-t.order)).map((({id:t,parent:n,label:r,url:o,target:i,object:a,type:u,objectId:c})=>(0,s.createBlock)(h,{id:t,parent:n,label:r,url:o,target:i,object:a,type:u,objectId:c},E(e,t)))):[],L=(e,t={})=>{const n=y(),r=null!=e?e:n,{isResolving:o,hasResolved:i}=R(r,t),[s,a,c,d]=k("items",r,t),[g,p]=k("menu",r,t),h=(0,u.useCallback)((e=>{const t=(e=>{let t=0;const n=(e,r=0)=>(0,l.flatten)(e.map((({attributes:e,innerBlocks:o})=>{const i=(0,l.merge)(M(),e);return t++,[{...(0,l.omit)(i,"kubio"),order:t,parent:r},...n(o,e.id)]})));return n(e)})(e);f()(s,t)||a(t)}),[a,s]);return{id:r,items:s,setItems:a,onChange:h,menu:g,setMenu:p,onInput:l.noop,itemsToBlocks:E,isResolving:o,hasResolved:i,lastChangeUID:c,lastReloadUID:d}},O=()=>(0,a.select)("core/block-editor").getSettings().kubioPrimaryMenuLocation,S=()=>{const e=O(),{getMenuLocations:t}=_(),n=t(),r=(0,u.useMemo)((()=>{var t;return null===(t=(0,l.find)(n,{name:e}))||void 0===t?void 0:t.menu}),[(null==n?void 0:n.length)||0]);return{...L(r),exists:!!r}},j=async(e=(0,c.__)("Main menu","kubio"))=>{const{saveMenu:t}=(0,a.dispatch)("core"),n=await t({name:e}),r=O();let o=null;n&&(o=n.id,await i()({path:"kubio/v1/menu/save-menu-location",method:"POST",data:{location:r,id:o}}),b=(0,g.generate)(),await(0,a.select)("core").getMenuLocations({_:b}))},_=()=>{const{menuLocations:e,setMenuLocations:n}=(0,t.useGlobalDataMenuLocations)(),{getMenuLocations:r,isResolvingLocation:o,hasResolvedLocations:i}=(0,a.useSelect)((e=>({getMenuLocations:e("core").getMenuLocations,isResolvingLocation:e("core").isResolving("getMenuLocations"),hasResolvedLocations:e("core").hasFinishedResolution("getMenuLocations")})));return{menuLocations:e||[],getMenuLocations:r,isResolvingLocation:o,hasResolvedLocations:i,updateLocationMenu:(t,r)=>{const o=e.map((e=>{const n={...e};return n.name===t&&(n.menu=parseInt(r)),n}));n(o)}}},C=({id:t,children:n})=>{const r=w().context.Provider,o=(0,u.useMemo)((()=>({id:t})),[t]);return(0,e.createElement)(r,{value:o},n)};(()=>{const e=(0,a.subscribe)((()=>{const t=(0,a.select)("core"),n=(0,a.dispatch)("core");if(!t||!n)return;const r=t.getEntitiesConfig("kubio"),{addEntities:o}=n;(0,l.find)(r,{name:p.name})||(o([p]),e())}))})()})(),(window.kubio=window.kubio||{}).menuData=r})();
